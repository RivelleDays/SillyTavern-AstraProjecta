:root {
    --bottomFormIconSize: 20px;
}

#sheld.flexPatch {
    display: flex;
    flex-direction: column;
    height: 100%;
}

#sheld.flexPatch #chat {
    flex-grow: 1;
}

#nonQRFormItems {
    gap: 4px;
    padding: 6px 12px;
    align-items: center;
}

#form_sheld {
    inset-block-end: 0;
    inset-inline: 0;
    margin: unset !important;
    padding: 0 12px;
    padding-bottom: calc(12px + var(--safe-bottom));
    position: -webkit-sticky;
    position: sticky;
    z-index: 1;
}

#send_form {
    background-color: var(--surface-base);
    border: 1px solid var(--color-base-t20);
    border-radius: 10px;
    opacity: 0.6;
    border-radius: 12px;
}

#send_textarea {
    font-size: var(--text-sm);
    line-height: var(--text-sm--line-height);
    height: unset;
}

#form_sheld {
    isolation: isolate;
}

#form_sheld::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(180deg, transparent 0%,
        color-mix(in srgb, var(--surface-base) 100%, transparent) 50%,
        color-mix(in srgb, var(--surface-base) 90%, transparent) 90%,
        color-mix(in srgb, var(--surface-base) 100%, transparent) 100%);
    opacity: 0.7;
    z-index: -1;
}

.astra-chat-send-panel {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: var(--space-3);
    margin: 12px 0;
}

.astra-chat-send-panel__left,
.astra-chat-send-panel__right {
	display: inline-flex;
	align-items: center;
	gap: var(--space-2);
	flex-wrap: wrap;
}

.astra-chat-send-panel__left {
	flex: 1 1 auto;
	justify-content: flex-start;
}

.astra-chat-send-panel__right {
	flex: 0 0 auto;
	justify-content: flex-end;
}

.astra-chat-send-panel__select-host {
	display: none;
}

.astra-chat-connection-trigger {
    display: inline-flex;
    align-items: center;
    justify-content: space-between;
    font-size: var(--text-xs);
    padding: 0 12px;
    border-radius: 20px;
    color: var(--color-base);
    background: var(--color-base-t5);
    border-color: var(--border-color-base);
    text-align: left;
    gap: 8px;
    height: 28px;
}

.astra-chat-search-trigger {
    display: none;
    justify-content: center;
}

.astra-chat-search-trigger__content {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
}

.astra-chat-search-trigger__icon {
    width: 16px;
    height: 16px;
    flex: 0 0 16px;
    color: var(--color-base);
}

.astra-chat-search-trigger__label {
    font-size: var(--text-xs);
    line-height: var(--text-xs--line-height);
    font-weight: var(--font-weight-medium);
    color: var(--color-base);
}

.astra-chat-connection-trigger:not(:disabled):hover,
.astra-chat-connection-trigger:focus-visible {
	background: var(--color-base-t5);
}

.astra-chat-connection-trigger__icon {
	flex: 0 0 auto;
	width: 16px;
	height: 16px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	color: var(--color-base);
}

.api-status-icon-wrap {
	display: inline-flex;
	align-items: center;
	justify-content: center;
}

.astra-chat-connection-trigger__icon .api-status-icon {
	width: 14px;
	height: 14px;
	display: block;
}

.astra-chat-connection-trigger__icon .api-status-icon--offline {
	opacity: 0.75;
}

.astra-chat-connection-trigger__value {
	flex: 1 1 auto;
	min-width: 0;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

.astra-chat-connection-trigger__chevron {
    opacity: 0.55;
	width: 12px;
	height: 12px;
	flex-shrink: 0;
}

.astra-chat-connection-menu__empty {
	padding: var(--space-2) var(--space-3);
	font-size: var(--text-xs);
	line-height: var(--text-xs--line-height);
	color: var(--color-muted);
	text-align: center;
}

.astra-chat-connection-menu {
	min-width: 224px;
	max-height: 288px;
	background: var(--popover);
	color: var(--popover-foreground);
	border-color: var(--border-color-base);
	box-shadow: var(--box-shadow);
	padding: var(--space-1);
	font-size: var(--text-xs);
	line-height: var(--text-xs--line-height);
	overflow: hidden;
}

.astra-chat-connection-menu__label {
	font-size: var(--text-xs);
	line-height: var(--text-xs--line-height);
	font-weight: var(--font-weight-medium);
	color: var(--color-muted);
	padding: var(--space-1) var(--space-2);
}

.astra-chat-connection-menu__separator {
    margin: var(--space-1) calc(var(--space-1) * -1);
    background: var(--border-color-base);
}

.astra-chat-connection-menu__options {
    display: flex;
    flex-direction: column;
    max-height: 40dvh;
    overflow-y: auto;
    padding: 0;
    margin: 0;
    gap: 4px;
}

.astra-chat-connection-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-3);
    font-size: var(--text-xs);
    min-height: 30px;
    padding: 8px 12px;
    border-radius: 8px;
}

.astra-chat-connection-option__label {
	flex: 1 1 auto;
	min-width: 0;
	text-align: left;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;

    @media screen and (max-width: 600px) {
        font-size: var(--text-sm);
    }
}

.astra-chat-connection-option__check {
	color: var(--foreground);
	flex: 0 0 16px;
	width: 16px;
	height: 16px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
}

.astra-chat-connection-option__check[data-selected='false'] {
	visibility: hidden;
}

.astra-chat-connection-option[data-selected='true'] {
	background: var(--color-base-t10);
}

.astra-chat-connection-option[data-selected='true'] .astra-chat-connection-option__label {
	font-weight: var(--font-weight-semibold);
	color: var(--foreground);
}

.astra-chat-context-usage-host {
	display: flex;
	align-items: stretch;
}

.astra-chat-context-usage-trigger {
    display: inline-flex;
    align-items: center;
    justify-content: space-between;
    font-size: var(--text-xs);
    padding: 0 8px;
    color: var(--color-base);
    border-color: var(--border-color-base);
    text-align: left;
    gap: 8px;
    height: 24px;
    opacity: 0.8;
}

.astra-chat-context-usage-trigger:hover,
.astra-chat-context-usage-trigger:focus-visible {
	opacity: 1;
    background: transparent;
}

.astra-chat-context-usage-trigger .astra-chat-context-usage__stat-value {
    font-size: var(--text-xs);
    font-weight: var(--font-weight-medium);
}

.astra-chat-context-usage-trigger__ring {
	width: 20px;
	height: 20px;
}

.astra-chat-context-usage-trigger__ring-track {
	fill: none;
	stroke: var(--color-base-t20);
	stroke-width: 2;
}

.astra-chat-context-usage-trigger__ring-value {
	fill: none;
	stroke-width: 2;
	stroke-linecap: round;
	stroke: var(--color-base);
	transform: rotate(-90deg);
	transform-origin: 50% 50%;
	transition:
		stroke-dashoffset 0.4s ease,
		stroke 0.2s ease;
}

.astra-chat-context-usage-trigger__ring-value.is-disabled {
	stroke: var(--color-base-t40);
}

.astra-chat-context-usage-popover {
	width: min(200px, calc(100vw - 32px));
	padding: 10px;
	background: var(--popover);
	color: var(--popover-foreground);
	border-color: var(--border-color-base);
}

.astra-chat-context-usage-popover__body {
	display: flex;
	flex-direction: column;
	gap: var(--space-2);
}

.astra-chat-context-usage-data {
    display: flex;
    align-items: center;
    width: 100%;
    background: var(--color-base-t10);
    border: 1px solid var(--border-color-base);
    border-radius: 999px;
    padding: 4px 12px;
    justify-content: center;
    gap: 12px;
}

.astra-chat-context-usage-data__icon {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	line-height: 0;
	color: var(--color-base);
}

.astra-chat-context-usage-data__tokens {
    font-weight: var(--font-weight-semibold);
    color: var(--foreground);
    font-size: var(--text-xs);
}

.astra-chat-context-usage-data__max {
	font-size: var(--text-xs);
	display: inline-flex;
	align-items: baseline;
	gap: 8px;
	color: var(--color-muted);
}

.astra-chat-context-usage-data__max-value {
    font-weight: var(--font-weight-medium);
    color: var(--color-muted);
}

.astra-chat-context-usage-data__separator {
	opacity: 0.6;
}

.astra-chat-context-usage-text-grid {
	display: flex;
	flex-direction: column;
	gap: 4px;
	font-size: var(--text-xs);
	line-height: var(--text-xs--line-height);
	color: var(--color-muted);
}

.astra-chat-context-usage-text-grid .astra-chat-context-usage-text-row__value {
	font-weight: var(--font-weight-regular);
	color: var(--color-muted);
}

.astra-chat-context-usage-text-grid--primary {
	display: flex;
	flex-direction: column;
	gap: 4px;
	font-size: var(--text-xs);
	line-height: var(--text-xs--line-height);
	color: var(--color-muted);
	margin-top: 4px;
}

.astra-chat-context-usage-text-grid--primary .astra-chat-context-usage-text-row__value {
	color: var(--foreground);
	font-weight: var(--font-weight-medium);
}

.astra-chat-context-usage-divider {
	height: 1px;
	background: var(--border-color-base);
	margin: 6px 0;
}

.astra-chat-context-usage-text-row {
	display: flex;
	align-items: baseline;
	justify-content: space-between;
	gap: var(--space-2);
}

.astra-chat-context-usage-text-row__label {
	font-weight: var(--font-weight-medium);
}

.astra-chat-context-usage-text-row__value {
	font-variant-numeric: tabular-nums;
}

.astra-chat-context-usage-popover__empty {
	margin-top: 4px;
	font-size: var(--text-xs);
	text-align: center;
	opacity: 0.8;
}

.astra-chat-connection-drawer {
	background: var(--surface-base);
	border-radius: 16px 16px 0 0;
	padding: 0;
	margin-top: 0;
	max-height: calc(100dvh - var(--mainTopBarHeight, 48px));
	height: auto;
	overflow: hidden;
}

.astra-chat-connection-drawer__header {
	display: flex;
	align-items: center;
	justify-content: space-between;
	gap: 12px;
	padding: 12px 16px;
    border-bottom: 1px solid var(--border-color-base);
}

.astra-chat-connection-drawer__title {
	font-size: var(--text-md);
	line-height: var(--text-md--line-height);
	font-weight: var(--font-weight-semibold);
	color: var(--foreground);
}

.astra-chat-connection-drawer__status {
	display: inline-flex;
	align-items: center;
	gap: 8px;
	color: var(--color-muted);
	font-size: var(--text-sm);
	line-height: var(--text-sm--line-height);
}

.astra-chat-connection-drawer__body {
	padding: 0 12px calc(14px + var(--safe-bottom, env(safe-area-inset-bottom, 0px)));
	max-height: calc(100dvh - var(--mainTopBarHeight, 48px));
	overflow-y: auto;
}

.astra-chat-connection-drawer__options {
	display: flex;
	flex-direction: column;
	gap: 6px;
	margin: 8px 0 4px;
}

@media screen and (max-width: 600px) {
    #form_sheld {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
    }

    #form_sheld #send_form {
        order: 1;
        width: 100%;
    }

    #form_sheld #astraChatSendFormPanel {
        order: 2;
        width: 100%;
        margin: 0;
    }

    #form_sheld .astra-chat-connection-trigger__value,
    #form_sheld .astra-chat-search-trigger__label {
        display: none;
    }
}
